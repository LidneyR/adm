  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Canoas ADM</title> 
      <link rel="shortcut icon" href="favico.png" type="image/png">

      <link rel="stylesheet" href="modal.css">
      <link rel="stylesheet" href="assets/components/notifications.css">
      <link rel="stylesheet" href="assets/components/getdataapi/getdata.css">
      <link rel="stylesheet" href="assets/components/home/home.css">
      <link rel="stylesheet" href="assets/components/delivery/deliveryorder.css">
      

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
  </head>
  <body> 
      <div id="app"></div> 
      <div id="closeForm" style="display: none;">
        <div class="controls">
            <button onclick="closeOrder(false)"><i class="fa-solid fa-chevron-left"></i></button>
            <button onclick="closeOrder(false)"><i class="fa-solid fa-xmark"></i></button>    
        </div>
        <form class="closeForm" action="">
            <div class="mylabel select">

                <label style="
                top: 0px;
                height: 46px;
            ">
                    <i class="fa-solid fa-file-invoice-dollar"></i>
                </label>

                <select onchange="formaRetirada()" id="selectCheckout">  
                 
                        <option value="1">Selecione a forma de Pagamento</option>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="pix">Pix</option>
                        <option value="debito">Debido Cartão</option>
                        <option value="credito">Crédito Cartão</option>
            
  
                </select>

          </div>
          <div class="placeCheckout">
            <button onclick="loseOrder(false)" class="btn cancel" type="button">cancelar</button>
            <button type="submit" class="btn closeOrders">Encerrar conta</button>
          </div>
        </form>
    
</div>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 

  <script src="api.js"></script>
  <script src="fluxo.js"></script>
  <script src="relatorio.js"></script>
  <script src="assets/components/whatsapp/whatsapp.js"></script>
  <script src="assets/components/relogio/relogio.js"></script>
  <script src="assets/components/modal.js"></script>
  <script src="assets/components/notifications.js"></script>
  <script src="assets/components/impressao/impressao.js"></script>
  <script src="assets/components/getdataapi/getdata.js"></script>
  <script src="assets/js/all.js"></script>
  <script src="assets/components/closeOrder/closeOrder.js"></script>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script type="module">
   
  const firebaseConfig = {
  apiKey: "AIzaSyAyxC6S9lIs2q6MXPJzB4rpjod3HbRXJgU",
  authDomain: "harmonyfoodapp.firebaseapp.com",
  databaseURL: "https://harmonyfoodapp-default-rtdb.firebaseio.com",
  projectId: "harmonyfoodapp",
  storageBucket: "harmonyfoodapp.appspot.com",
  messagingSenderId: "910886750410",
  appId: "1:910886750410:web:810fa41051ae6d12684c33",
  measurementId: "G-9HD4J8Z2XP"
  }; 
  
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig); 
  const db = firebase.firestore();
  let formClose=document.querySelector('.closeForm')
  let horaAtual=relogio()
//   let data=dataHora()

 

  formClose.addEventListener('submit', function(e){
    e.preventDefault()   
    alert('Conta encerrada com sucesso!') 
    console.log(plataforma)
    contasClosedb.map((clc)=>{
        console.log(clc.contasFechadas)
        clc.contasFechadas.map((cf)=>{
        
                unifechamentos.push(cf)

        })
        unifechamentos.push(clc.contasFechadas)
        
    })
    unifechamentos.push(contaFechada)
 
//    conta que pediu fechamento console.log(contaFechada)

            // db.collection('fechamentos').doc(data).set({
            //     "name":"fechamentos",
            //     "contasFechadas":unifechamentos, 

            // })

    setTimeout(function(){
        if(plataforma=='Mesas'){
       
        db.collection("mesasOpen").doc(idConta).delete().then(() => {
            console.log("Document successfully deleted!");
        }).catch((error) => {
            console.error("Error removing document: ", error);
        });
            
            }else{
                db.collection("delivery").doc(idConta).delete().then(() => {
                    console.log("Document successfully deleted!");
                }).catch((error) => {
                    console.error("Error removing document: ", error);
                });
            }
    }, 3000)
   
    // //DELETE 
   
    // db.collection("mesasOpen").doc("12").delete().then(() => {
    //     console.log("Document successfully deleted!");
    // }).catch((error) => {
    //     console.error("Error removing document: ", error);
    // });
 
  })






  let list = document.getElementById("notifications") 
  const ordersLab=db.collection('mesasOpen') 
 

    ordersLab.onSnapshot((snapshot) => { 
        
        notQtd.innerHTML=""
        let pedidosAll=[]   

        snapshot.forEach((doc) => {
            pedidosAll.push(doc.data())   
            notQtd.innerHTML=pedidosAll.length 
            let storegeProds=JSON.stringify(pedidosAll) 

            getData(pedidosAll)
            appNotification(pedidosAll,'mesa')

        }); 
    }, (error) => {
        console.log('Erro api')
    });


 
    //REQUEST DELIVERY 
    const ordersDelivery=db.collection('delivery')
    const pedidosDeliveryContainer=document.getElementById('pedidosbalcao')

    
    ordersDelivery.onSnapshot((snapshot) => { 
        let deliveryAll=[]
        snapshot.forEach((doc) => { 
            deliveryAll.push(doc.data())  
        }); 

        if(deliveryAll){
            deliveryData(deliveryAll)
            appNotification(deliveryAll,'delivery')
        }
        // ..
    }, (error) => {
        // ...
    });


    //REQUEST NOTIFICAÇÕES 
    const ordersNotifications=db.collection('notificacoes')  
    ordersNotifications.onSnapshot((snapshot) => { 
        let notificationsBd=[]
        snapshot.forEach((doc) => { 
            notificationsBd.push(doc.data())  
            innerSequenceOrders(notificationsBd) 
        }); 

        if(deliveryAll!=false){
            deliveryData(deliveryAll)
            appNotification(deliveryAll,'delivery')
        }
        // ..
    }, (error) => {
        // ...
    });


    //REQUEST CONTAS CLOSE 
    const contasClose=db.collection('fechamentos')  
    contasClose.onSnapshot((snapshot) => { 
        let mapContasClose=[]
        snapshot.forEach((doc) => { 
            mapContasClose.push(doc.data()) 
            contasClosedb.push(doc.data()) 
            // innerSequenceOrders(notificationsBd) 
        }); 
 
        // ..
    }, (error) => {
        // ...
    });


 
  </script>

  </html>